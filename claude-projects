#!/usr/bin/env python3
import sys
from pathlib import Path
sys.path.insert(0, str(Path(__file__).parent))

from lib.registry import Registry

def main():
    registry = Registry()

    if len(sys.argv) < 2:
        print("Usage: claude-projects [add|remove|list|worked]")
        return 1

    cmd = sys.argv[1]

    if cmd == "add":
        if len(sys.argv) != 4:
            print("Usage: claude-projects add <name> <path>")
            return 1
        registry.add(sys.argv[2], sys.argv[3])
        print(f"Added {sys.argv[2]}")

    elif cmd == "remove":
        if len(sys.argv) != 3:
            print("Usage: claude-projects remove <name>")
            return 1
        registry.remove(sys.argv[2])
        print(f"Removed {sys.argv[2]}")

    elif cmd == "list":
        projects = registry.list()
        for name, data in sorted(projects.items(),
                                key=lambda x: x[1]["last_worked"],
                                reverse=True):
            print(f"{name:30} {data['path']:50} {data['last_worked']}")

    elif cmd == "worked":
        if len(sys.argv) != 3:
            print("Usage: claude-projects worked <name>")
            return 1
        registry.worked(sys.argv[2])
        print(f"Updated {sys.argv[2]}")

    else:
        print(f"Unknown command: {cmd}")
        return 1

    return 0

if __name__ == "__main__":
    sys.exit(main())
